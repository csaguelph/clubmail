---
description: tRPC and Prisma backend architecture rules
globs:
  - "src/server/**/*"
  - "prisma/**/*"
alwaysApply: false
---

# tRPC

- Put backend business logic in **tRPC routers** under `src/server/api`.
- Every procedure: **Zod-validated input**, no `any`, use project helpers (`createTRPCRouter`, `publicProcedure`, `protectedProcedure`, etc.).
- Keep procedures small; move heavy logic into helpers in `src/server` or `src/lib`.

# Prisma

- Use Prisma via `@/server/db` only; never call `new PrismaClient()`.
- Prefer generated Prisma types (e.g. payload helpers) over custom interfaces.
- Use explicit `select`/`include` for predictable types and minimal overfetching.

# Types

- Derive request/response types from tRPC routers (`RouterInputs`, `RouterOutputs`) and Prisma.
- Avoid DTOs that simply mirror router or Prisma types.